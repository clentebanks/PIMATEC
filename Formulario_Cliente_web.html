<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Formulario Cliente - P√°gina Web</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f7fa;
    }
    .form-container {
      background: #fff;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 0 20px rgba(24, 17, 17, 0.1);
      margin-top: 40px;
      margin-bottom: 40px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<div class="container d-flex justify-content-center">
  <div class="form-container w-100" style="max-width: 80%;"" id="form-container">
    <h2 class="mb-4 text-center">Formulario de Solicitud para P√°gina Web</h2>
    <form id="webForm">
      <!-- 1. Informaci√≥n General -->
      <h5>1. Informaci√≥n General</h5>
      <div class="mb-3">
        <label>Nombre completo</label>
        <input type="text" class="form-control" name="nombre" required>
      </div>
      <div class="mb-3">
        <label>Empresa o Marca</label>
        <input type="text" class="form-control" name="empresa">
      </div>
      <div class="mb-3">
        <label>Correo electr√≥nico</label>
        <input type="email" class="form-control" name="correo" required>
      </div>
      <div class="mb-3">
        <label>Tel√©fono / WhatsApp</label>
        <input type="tel" class="form-control" name="telefono" required pattern="[0-9+ ]{7,15}">
      </div>

      <!-- 2. Objetivo -->
      <h5 class="mt-4">2. Objetivo del Sitio</h5>
      <div class="mb-3">
        <label>¬øCu√°l es el objetivo principal?</label>
        <textarea class="form-control" name="objetivo" rows="2" required></textarea>
      </div>

      <!-- 3. Tipo de Sitio -->
      <h5 class="mt-4">3. Tipo de Sitio</h5>
      <div class="mb-3">
        <select class="form-select" name="tipo_sitio" id="tipoSitio" required>
          <option value="">Selecciona una opci√≥n</option>
          <option value="institucional">P√°gina institucional</option>
          <option value="tienda">Tienda online</option>
          <option value="blog">Blog</option>
          <option value="portafolio">Portafolio</option>
          <option value="landing">Landing Page</option>
        </select>
      </div>

      <!-- Condicional: Solo si es tienda online -->
      <div id="tiendaExtra" class="hidden">
        <h6>Detalles de Tienda Online</h6>
        <div class="mb-3">
          <label>¬øCu√°ntos productos ofrecer√°s aproximadamente?</label>
          <input type="number" class="form-control" name="productos" min="1">
        </div>
        <div class="mb-3">
          <label>¬øQu√© m√©todo de pago quieres integrar?</label>
          <input type="text" class="form-control" name="metodo_pago">
        </div>
      </div>

      <!-- 4. Contenido -->
      <h5 class="mt-4">4. Contenido</h5>
      <div class="mb-3">
        <label>Secciones deseadas (Inicio, Nosotros, etc.)</label>
        <input type="text" class="form-control" name="secciones" required>
      </div>
        
      <!-- 5. Dise√±o -->
      <h5 class="mt-4">5. Dise√±o y Estilo</h5>
      <div class="mb-3">
        <label>Paleta de colores o estilo</label>
        <textarea class="form-control" name="estilo" rows="2"></textarea>
      </div>

      <!-- 6. Funcionalidades -->
      <h5 class="mt-4">6. Funcionalidades Extras</h5>
      <div class="mb-3">
        <label>Selecciona lo que necesitas</label>
        <textarea class="form-control" name="funcionalidades" rows="2"></textarea>
      </div>
      <!-- Secci√≥n 7 -->
      <div class="form-section">
        <h5 class="mt-4">7. Plazos y Presupuesto</h5>
        <div class="mb-3">
          <label class="form-label">Presupuesto estimado</label>
          <select class="form-select" name="Presupuesto">
            <option>Menos de $200</option>
            <option>$200 ‚Äì $500</option>
            <option>$500 ‚Äì $1000</option>
            <option>M√°s de $1000</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Plazo estimado</label>
          <select class="form-select" name="Plazo">
            <option>Urgente (menos de 1 semana)</option>
            <option>1 ‚Äì 2 semanas</option>
            <option>1 mes</option>
            <option>Flexible / No tengo prisa</option>
          </select>
        </div>
      </div>
      <!-- 8. Comentarios -->
      <h5 class="mt-4">8. Comentarios adicionales</h5>
      <div class="mb-3">
        <textarea class="form-control" name="comentarios" rows="4" placeholder="¬øAlgo m√°s que deber√≠amos saber?"></textarea>
      </div>

      <!-- Mensajes -->
      <div id="msg" class="alert d-none"></div>
      <!-- Alerta responsiva y flexible con Bootstrap -->
      <div class="row mt-3">
        <div class="col-12">
          <div class="alert alert-warning text-center" role="alert">
            ‚ö†Ô∏è <strong>Importante:</strong> Antes de enviar, aseg√∫rate de <strong>descargar el PDF</strong> haciendo clic en el bot√≥n correspondiente.
          </div>
        </div>
      </div>

     <!-- Botones de acci√≥n -->
      <div class="d-flex flex-column flex-md-row justify-content-between mt-4 gap-3">
        <button type="submit" class="btn btn-primary w-100 w-md-auto">Enviar</button>
        <button type="button" class="btn btn-warning w-100 w-md-auto" onclick="descargarPDF()" id="descargar-pdf">
          üìÑ Descargar PDF
        </button>
      </div>
    </form>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script src="js/html2canvas.js" ></script>
<script src="js/jspdf.debug.js" ></script>
<script>
  const tipoSitio = document.getElementById('tipoSitio');
  const tiendaExtra = document.getElementById('tiendaExtra');
  const msg = document.getElementById('msg');

  // Mostrar/ocultar secci√≥n de tienda
  tipoSitio.addEventListener('change', () => {
    tiendaExtra.classList.toggle('hidden', tipoSitio.value !== 'tienda');
  });

  // Env√≠o a Google Sheets
  const scriptURL = 'https://script.google.com/macros/s/AKfycby2i6kBxs9GnHqonf1PXixTeUjdQAlpGT8ul_zsSRYMNZzffGeW0JtosF9d9WGAfTreig/exec'; // ‚Üê pega tu URL aqu√≠
  const form = document.getElementById('webForm');

  form.addEventListener('submit', e => {
    e.preventDefault();
    msg.classList.add('d-none');

    // Validaci√≥n extra si es tienda
    if (tipoSitio.value === 'tienda') {
      const productos = form.querySelector('input[name="productos"]');
      const metodo = form.querySelector('input[name="metodo_pago"]');
      if (!productos.value || !metodo.value) {
        msg.textContent = 'Por favor completa los campos adicionales de la tienda online.';
        msg.className = 'alert alert-warning';
        msg.classList.remove('d-none');
        return;
      }
    }

    fetch(scriptURL, { method: 'POST', body: new FormData(form) })
      .then(response => {
        msg.textContent = '‚úÖ ¬°Formulario enviado con √©xito!';
        msg.className = 'alert alert-success';
        msg.classList.remove('d-none');
        form.reset();
        tiendaExtra.classList.add('hidden');
      })
      .catch(error => {
        msg.textContent = '‚ùå Ocurri√≥ un error al enviar los datos.';
        msg.className = 'alert alert-danger';
        msg.classList.remove('d-none');
      });
  });

  // Descargar PDF
      // Se obtiene el elemento HTML con el id 'form-container' y se guarda en la variable 'formulario'
var formulario = document.getElementById('form-container');

// Se obtiene el bot√≥n (o enlace) con el id 'descargar-pdf' y se guarda en la variable 'descargar_pdf'
var descargar_pdf = document.getElementById('descargar-pdf');

// Se define una funci√≥n que se ejecutar√° cuando se haga clic en el bot√≥n 'descargar_pdf'
descargar_pdf.onclick = function() {

  // Se crea un nuevo documento PDF usando la librer√≠a jsPDF
  // 'p' indica orientaci√≥n vertical (portrait), 'pt' es la unidad (puntos), y 'letter' es el tama√±o de hoja
  var doc = new jsPDF('p', 'pt', 'letter');

  // Se define un margen de 20 puntos alrededor del contenido
  var margin = 20;

  // Se calcula una escala para ajustar el contenido de la p√°gina al tama√±o del PDF en pantallas grandes
  var scale = (doc.internal.pageSize.width - margin * 2) / document.body.clientWidth;

  // Se intenta calcular una escala para dispositivos m√≥viles (aqu√≠ hay un error, lo veremos m√°s abajo)
  var scale_mobile = (doc.internal.pageSize.width - margin * 2) / document.body.getBoundingClientRect();

  // Se verifica si el usuario est√° en un dispositivo m√≥vil usando el 'userAgent' del navegador
  if(/Android|weBOS|iPhone|iPod|IEmobile|Opera Mini/i.test(navigator.userAgent)){

    // Si es un dispositivo m√≥vil, se genera el PDF usando el contenido del formulario
    doc.html(formulario, {
      x: margin, // posici√≥n X donde se empieza a colocar el contenido
      y: margin, // posici√≥n Y donde se empieza a colocar el contenido
      html2canvas: {
        scale: scale_mobile // escala para renderizar el contenido correctamente en m√≥viles
      },
      callback: function(doc) {
        // Cuando el PDF est√© listo, se abre en una nueva ventana del navegador
        doc.output('dataurlnewwindow', {filename: 'pdf.pdf'});
      }
    });

  } else {

    // Si es una computadora de escritorio, se genera el PDF igual pero usando otra escala
    doc.html(formulario, {
      x: margin,
      y: margin,
      html2canvas: {
        scale: scale // escala adecuada para pantallas grandes
      },
      callback: function(doc) {
        doc.output('dataurlnewwindow', {filename: 'pdf.pdf'});
      }
    });

  }
}

</script>


</body>


